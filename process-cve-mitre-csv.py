#!/usr/bin/env python3

import csv
import re

print("CVE,assignedDate,PublishedInYear")

with open('allitems.csv', newline='',  encoding='ISO-8859-1') as csvfile:
    cvereader= csv.reader(csvfile, delimiter=',', quotechar='"')
    for row in cvereader:
        if re.search('^CVE-', row[0]):
            # Ignore reserved
            if re.search('^\*\* RESERVED \*\* ', row[2]):
                pass
            else:
                data_CVE=row[0]
                data_CVEYear=re.sub('^CVE-', '', row[0])
                data_CVEYear=re.sub('-[0-9]*$', '', data_CVEYear)

                # If we have an assignedDate value use it
                if re.search('Assigned \(', row[4]):
                    data_assignedDateYear=re.sub('^Assigned \(', '', row[4])
                    data_assignedDateYear=re.sub('[0-9][0-9][0-9][0-9]\)$', '', data_assignedDateYear)
                # If we do not have an assignedDate use the CVE year
                else:
                    data_assignedDateYear=data_CVEYear

                # Add logic to check for reserved IDs
                if int(data_assignedDateYear) < int(data_CVEYear):
                    data_Year_Used = data_CVEYear
                else:
                    data_Year_Used = data_assignedDateYear

                print(data_CVE + "," + data_assignedDateYear + "," + data_Year_Used)
